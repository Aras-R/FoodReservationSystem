@model FoodReservation.Application.Services.Users.Commands.RequestRegisterUserDto

@{
    ViewData["Title"] = "ثبت کاربر جدید";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<link rel="stylesheet" href="~/css/admin-user-register.css?v=@DateTime.Now.Ticks" />
<link rel="stylesheet" href="~/Sweetalert2/Sweetalert2.min.css?v=@DateTime.Now.Ticks" />

<div class="register-page">
    <div class="register-card">
        <h3 class="form-title"> ثبت کاربر جدید</h3>

        @if (ViewBag.Message != null)
        {
            <div class="alert-message">@ViewBag.Message</div>
        }

        <form id="registerForm" method="post" class="register-form">
            <div class="form-group">
                <label>شماره دانشجویی:</label>
                <input type="text" name="StudentNumber" placeholder="مثلاً 40102563" required />
            </div>

            <div class="form-group">
                <label>نام و نام خانوادگی:</label>
                <input type="text" name="FullName" placeholder="مثلاً آراس رسول‌زاده" required />
            </div>

            <div class="form-group">
                <label>رمز عبور:</label>
                <input type="password" name="Password" placeholder="رمز عبور" required />
            </div>

            <div class="form-group">
                <label>تکرار رمز عبور:</label>
                <input type="password" name="RePassword" placeholder="تکرار رمز عبور" required />
            </div>

            <div class="form-group">
                <label>نقش کاربر:</label>
                <select name="Role">
                    <option value="0">دانشجو</option>
                    <option value="1">ادمین</option>
                </select>
            </div>

            <div class="btn-container">
                <button type="submit" class="btn-submit">✅ ثبت کاربر</button>
                <a href="/Admin/User/Index" class="btn-cancel">↩️ بازگشت</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script src="~/Sweetalert2/Sweetalert2.min.js"></script>

    <script>
        document.getElementById("registerForm").addEventListener("submit", function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            if (data.Password !== data.RePassword) {
                Swal.fire("خطا", "رمز عبور و تکرار آن یکسان نیست!", "error");
                return;
            }

            fetch("/Admin/User/Register", {
                method: "POST",
                body: formData
            })
            .then(res => res.text())
            .then(response => {
                Swal.fire({
                    title: "ثبت موفق ✅",
                    text: "کاربر با موفقیت اضافه شد.",
                    icon: "success",
                    confirmButtonText: "باشه"
                }).then(() => {
                    window.location.href = "/Admin/User/Index";
                });
            })
            .catch(() => Swal.fire("خطا", "مشکلی در ثبت کاربر پیش آمد!", "error"));
        });
    </script>
}
