@using System.Globalization
@model List<FoodReservation.Application.Services.DailyFoods.Queries.DailyFoodListDto>

@{
    ViewData["Title"] = "لیست برنامه‌های غذایی روزانه";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    var persian = new CultureInfo("fa-IR");
}

<link rel="stylesheet" href="~/css/admin-dailyfood-list.css?v=@DateTime.Now.Ticks" />
<link rel="stylesheet" href="~/Sweetalert2/Sweetalert2.min.css?v=@DateTime.Now.Ticks" />


<h3 class="page-title">📋 لیست برنامه‌های غذایی روزانه</h3>

@if (TempData["Error"] != null)
{
    <div class="alert">@TempData["Error"]</div>
}


<table class="dailyfood-table">
    <thead>
        <tr>
            <th>#</th>
            <th>روز هفته</th>
            <th>تاریخ</th>
            <th>وعده غذایی</th>
            <th>نام غذا</th>
            <th>عملیات</th>
        </tr>
    </thead>
    <tbody>
        @if (Model != null && Model.Any())
        {
            int i = 1;
            foreach (var item in Model)
            {
                <tr>
                    <td>@i</td>
                    <td>@item.DayOfWeek</td>
                    <td>
                        @(item.Date > DateTime.MinValue
                                        ? item.Date.ToString("yyyy/MM/dd", persian)
                                        : "-")
                    </td>
                    <td>@item.MealType</td>
                    <td>@item.FoodName</td>
                    <td>
                        <a href="@Url.Action("Edit", "DailyFood", new { area = "Admin", id = item.Id })" class="btn-edit">ویرایش</a>
                    <button type="button" class="btn-delete" onclick="confirmDelete(@item.Id)">حذف</button>
            </td>
                </tr>
                i++;
            }
        }
        else
        {
            <tr>
                <td colspan="6" class="no-data">هیچ برنامه‌ای ثبت نشده است</td>
            </tr>
        }
    </tbody>
</table>


@section Scripts {
    <script src="~/Sweetalert2/Sweetalert2.min.js"></script>
    <script>
        function confirmDelete(id) {
            Swal.fire({
                title: 'آیا مطمئن هستید؟',
                text: "این عملیات قابل بازگشت نیست!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'بله، حذف شود!',
                cancelButtonText: 'انصراف'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch('/Admin/DailyFood/Remove', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ id: id })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.isSuccess) {
                            Swal.fire({
                                title: 'حذف شد!',
                                text: data.message || 'برنامه غذایی با موفقیت حذف شد.',
                                icon: 'success'
                            }).then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire('خطا!', data.message || 'مشکلی در حذف اطلاعات رخ داد.', 'error');
                        }
                    })
                    .catch(() => {
                        Swal.fire('خطا!', 'ارتباط با سرور برقرار نشد.', 'error');
                    });
                }
            });
        }
    </script>

}

